{"ast":null,"code":"import{useState,useRef,useEffect}from\"react\";import{motion}from\"framer-motion\";import{Palette,MousePointer,RotateCcw,Settings}from\"lucide-react\";import{Button}from\"@/components/ui/button\";import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const ColorPicker=_ref=>{let{imageSrc,onColorSelect,selectedColor,onReset}=_ref;const[isActive,setIsActive]=useState(false);const[cursorPosition,setCursorPosition]=useState({x:0,y:0});const[pickedColor,setPickedColor]=useState(null);const[sampleSize,setSampleSize]=useState(20);// Default 20x20 pixels\nconst[useMedian,setUseMedian]=useState(false);// Toggle between average and median\nconst[displaySampleSize,setDisplaySampleSize]=useState(20);// Scaled size for display\nconst canvasRef=useRef(null);const imageRef=useRef(null);useEffect(()=>{if(imageSrc&&canvasRef.current){const canvas=canvasRef.current;const ctx=canvas.getContext('2d');const img=new Image();img.onload=()=>{// Set canvas size to match image display size\nconst rect=imageRef.current.getBoundingClientRect();canvas.width=rect.width;canvas.height=rect.height;// Draw image on canvas\nctx.drawImage(img,0,0,canvas.width,canvas.height);};img.src=imageSrc;}},[imageSrc]);/**\r\n   * Calculate brightness of an RGB pixel\r\n   */const calculateBrightness=(r,g,b)=>{// Using relative luminance formula\nreturn r*0.299+g*0.587+b*0.114;};/**\r\n   * Sample a region around the tap point and calculate average/median RGB\r\n   */const sampleRegionRGB=function(ctx,centerX,centerY,size){let useMedian=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;const halfSize=Math.floor(size/2);// Calculate bounds, ensuring we don't go outside canvas\nconst startX=Math.max(0,Math.floor(centerX-halfSize));const startY=Math.max(0,Math.floor(centerY-halfSize));const endX=Math.min(ctx.canvas.width,Math.floor(centerX+halfSize));const endY=Math.min(ctx.canvas.height,Math.floor(centerY+halfSize));const width=endX-startX;const height=endY-startY;// Get image data for the region\nconst imageData=ctx.getImageData(startX,startY,width,height);const data=imageData.data;// Collect valid pixels (non-transparent and not too bright)\nconst validPixels=[];const brightnessThreshold=250;// Ignore extremely bright glare pixels\nfor(let i=0;i<data.length;i+=4){const r=data[i];const g=data[i+1];const b=data[i+2];const a=data[i+3];// Alpha channel\n// Skip transparent pixels (alpha < 255)\nif(a<255)continue;// Skip extremely bright pixels (glare)\nconst brightness=calculateBrightness(r,g,b);if(brightness>brightnessThreshold)continue;validPixels.push({r,g,b});}if(validPixels.length===0){// Fallback: if no valid pixels, use all non-transparent pixels\nfor(let i=0;i<data.length;i+=4){const r=data[i];const g=data[i+1];const b=data[i+2];const a=data[i+3];if(a>=255){validPixels.push({r,g,b});}}}if(validPixels.length===0){// Last resort: use center pixel\nconst centerIdx=Math.floor(width*height/2)*4;return[Math.round(data[centerIdx]),Math.round(data[centerIdx+1]),Math.round(data[centerIdx+2])];}if(useMedian){// Calculate median RGB\nconst sortedR=validPixels.map(p=>p.r).sort((a,b)=>a-b);const sortedG=validPixels.map(p=>p.g).sort((a,b)=>a-b);const sortedB=validPixels.map(p=>p.b).sort((a,b)=>a-b);const mid=Math.floor(sortedR.length/2);return[sortedR.length%2===0?Math.round((sortedR[mid-1]+sortedR[mid])/2):sortedR[mid],sortedG.length%2===0?Math.round((sortedG[mid-1]+sortedG[mid])/2):sortedG[mid],sortedB.length%2===0?Math.round((sortedB[mid-1]+sortedB[mid])/2):sortedB[mid]];}else{// Calculate average RGB\nconst sum=validPixels.reduce((acc,pixel)=>({r:acc.r+pixel.r,g:acc.g+pixel.g,b:acc.b+pixel.b}),{r:0,g:0,b:0});return[Math.round(sum.r/validPixels.length),Math.round(sum.g/validPixels.length),Math.round(sum.b/validPixels.length)];}};const handleImageClick=e=>{if(!isActive)return;const canvas=canvasRef.current;if(!canvas)return;const rect=e.currentTarget.getBoundingClientRect();const scaleX=canvas.width/rect.width;const scaleY=canvas.height/rect.height;const x=(e.clientX-rect.left)*scaleX;const y=(e.clientY-rect.top)*scaleY;const ctx=canvas.getContext('2d');// Sample region around tap point\nconst color=sampleRegionRGB(ctx,x,y,sampleSize,useMedian);setPickedColor(color);onColorSelect(color);setIsActive(false);};const handleMouseMove=e=>{if(!isActive)return;const rect=imageRef.current.getBoundingClientRect();const x=e.clientX-rect.left;const y=e.clientY-rect.top;setCursorPosition({x,y});// Calculate display size for the sampling region indicator\nif(canvasRef.current&&imageRef.current){const scaleX=rect.width/canvasRef.current.width;const scaleY=rect.height/canvasRef.current.height;const scaledSize=sampleSize*Math.min(scaleX,scaleY);setDisplaySampleSize(scaledSize);}};const toggleColorPicker=()=>{setIsActive(!isActive);};const resetColor=()=>{setPickedColor(null);onReset();};return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"194\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_194\",\"x-dynamic\":\"true\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"196\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_196\",\"x-dynamic\":\"true\",children:[/*#__PURE__*/_jsx(\"img\",{ref:imageRef,\"data-testid\":\"image-preview\",src:imageSrc,alt:\"Preview\",className:\"w-full max-h-96 object-contain rounded-2xl \".concat(isActive?'cursor-crosshair':'cursor-default'),onClick:handleImageClick,onMouseMove:handleMouseMove,\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"197\",\"x-component\":\"img\",\"x-id\":\"ColorPicker_197\",\"x-dynamic\":\"false\"}),isActive&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute w-2 h-2 bg-white rounded-full shadow-lg pointer-events-none z-10\",style:{left:cursorPosition.x-4,top:cursorPosition.y-4},\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"213\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_213\",\"x-dynamic\":\"false\"}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute border-2 border-blue-500 border-dashed pointer-events-none z-10\",style:{left:cursorPosition.x-displaySampleSize/2,top:cursorPosition.y-displaySampleSize/2,width:displaySampleSize,height:displaySampleSize},\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"221\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_221\",\"x-dynamic\":\"false\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"235\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_235\",\"x-dynamic\":\"true\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center gap-4 flex-wrap\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"236\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_236\",\"x-dynamic\":\"true\",children:[/*#__PURE__*/_jsx(\"div\",{\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"237\",\"x-component\":\"Button\",\"x-id\":\"ColorPicker_237\",\"x-dynamic\":\"true\",\"data-debug-wrapper\":\"true\",style:{display:\"contents\"},children:/*#__PURE__*/_jsxs(Button,{onClick:toggleColorPicker,variant:isActive?\"default\":\"outline\",className:\"\".concat(isActive?\"bg-blue-600 text-white hover:bg-blue-700\":\"border-blue-600 text-blue-600 hover:bg-blue-50\"),children:[/*#__PURE__*/_jsx(\"div\",{\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"246\",\"x-component\":\"Palette\",\"x-id\":\"ColorPicker_246\",\"x-dynamic\":\"false\",\"data-debug-wrapper\":\"true\",style:{display:\"contents\"},children:/*#__PURE__*/_jsx(Palette,{className:\"mr-2 h-4 w-4\"})}),isActive?\"Click on Image to Pick Color\":\"Pick Color Manually\"]})}),(pickedColor||selectedColor)&&/*#__PURE__*/_jsx(\"div\",{\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"251\",\"x-component\":\"Button\",\"x-id\":\"ColorPicker_251\",\"x-dynamic\":\"true\",\"data-debug-wrapper\":\"true\",style:{display:\"contents\"},children:/*#__PURE__*/_jsxs(Button,{onClick:resetColor,variant:\"outline\",className:\"border-gray-300 text-gray-600 hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"div\",{\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"256\",\"x-component\":\"RotateCcw\",\"x-id\":\"ColorPicker_256\",\"x-dynamic\":\"false\",\"data-debug-wrapper\":\"true\",style:{display:\"contents\"},children:/*#__PURE__*/_jsx(RotateCcw,{className:\"mr-2 h-4 w-4\"})}),\"Reset to Auto\"]})})]}),isActive&&/*#__PURE__*/_jsxs(motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:\"auto\"},className:\"bg-gray-50 rounded-lg p-4 space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-sm font-medium text-gray-700\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"269\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_269\",\"x-dynamic\":\"false\",children:[/*#__PURE__*/_jsx(Settings,{className:\"h-4 w-4\"}),\"Sampling Settings\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"275\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_275\",\"x-dynamic\":\"false\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"text-xs text-gray-600\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"276\",\"x-component\":\"label\",\"x-id\":\"ColorPicker_276\",\"x-dynamic\":\"true\",children:[\"Sample Size: \",sampleSize,\"\\xD7\",sampleSize,\" pixels\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"279\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_279\",\"x-dynamic\":\"false\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:\"10\",max:\"50\",step:\"5\",value:sampleSize,onChange:e=>setSampleSize(Number(e.target.value)),className:\"flex-1\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"280\",\"x-component\":\"input\",\"x-id\":\"ColorPicker_280\",\"x-dynamic\":\"false\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs text-gray-500 w-12 text-right\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"289\",\"x-component\":\"span\",\"x-id\":\"ColorPicker_289\",\"x-dynamic\":\"true\",children:[sampleSize,\"px\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2 text-xs text-gray-500\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"293\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_293\",\"x-dynamic\":\"false\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSampleSize(10),className:\"px-2 py-1 rounded \".concat(sampleSize===10?'bg-blue-100 text-blue-700':''),\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"294\",\"x-component\":\"button\",\"x-id\":\"ColorPicker_294\",\"x-dynamic\":\"false\",children:\"10\\xD710\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSampleSize(20),className:\"px-2 py-1 rounded \".concat(sampleSize===20?'bg-blue-100 text-blue-700':''),\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"300\",\"x-component\":\"button\",\"x-id\":\"ColorPicker_300\",\"x-dynamic\":\"false\",children:\"20\\xD720\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSampleSize(30),className:\"px-2 py-1 rounded \".concat(sampleSize===30?'bg-blue-100 text-blue-700':''),\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"306\",\"x-component\":\"button\",\"x-id\":\"ColorPicker_306\",\"x-dynamic\":\"false\",children:\"30\\xD730\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"316\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_316\",\"x-dynamic\":\"false\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-xs text-gray-600\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"317\",\"x-component\":\"label\",\"x-id\":\"ColorPicker_317\",\"x-dynamic\":\"false\",children:\"Calculation Method:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"318\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_318\",\"x-dynamic\":\"false\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setUseMedian(false),className:\"px-3 py-1 rounded text-xs \".concat(!useMedian?'bg-blue-600 text-white':'bg-gray-200 text-gray-600 hover:bg-gray-300'),\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"319\",\"x-component\":\"button\",\"x-id\":\"ColorPicker_319\",\"x-dynamic\":\"false\",children:\"Average\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setUseMedian(true),className:\"px-3 py-1 rounded text-xs \".concat(useMedian?'bg-blue-600 text-white':'bg-gray-200 text-gray-600 hover:bg-gray-300'),\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"329\",\"x-component\":\"button\",\"x-id\":\"ColorPicker_329\",\"x-dynamic\":\"false\",children:\"Median\"})]})]})]})]}),isActive&&/*#__PURE__*/_jsx(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:\"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center gap-2 text-blue-700\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"352\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_352\",\"x-dynamic\":\"false\",children:[/*#__PURE__*/_jsx(\"div\",{\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"353\",\"x-component\":\"MousePointer\",\"x-id\":\"ColorPicker_353\",\"x-dynamic\":\"false\",\"data-debug-wrapper\":\"true\",style:{display:\"contents\"},children:/*#__PURE__*/_jsx(MousePointer,{className:\"h-4 w-4\"})}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"354\",\"x-component\":\"span\",\"x-id\":\"ColorPicker_354\",\"x-dynamic\":\"true\",children:[\"Click on the test tube to sample a \",sampleSize,\"\\xD7\",sampleSize,\" region (\",useMedian?'median':'average',\" RGB)\"]})]})}),(pickedColor||selectedColor)&&/*#__PURE__*/_jsx(motion.div,{initial:{opacity:0,scale:0.95},animate:{opacity:1,scale:1},className:\"bg-gray-50 rounded-lg p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"368\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_368\",\"x-dynamic\":\"false\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-600 mb-2\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"369\",\"x-component\":\"p\",\"x-id\":\"ColorPicker_369\",\"x-dynamic\":\"false\",children:\"Selected Color\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center gap-4\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"370\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_370\",\"x-dynamic\":\"false\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 rounded-lg shadow-md border-2 border-white\",style:{backgroundColor:\"rgb(\".concat((pickedColor===null||pickedColor===void 0?void 0:pickedColor[0])||(selectedColor===null||selectedColor===void 0?void 0:selectedColor[0]),\", \").concat((pickedColor===null||pickedColor===void 0?void 0:pickedColor[1])||(selectedColor===null||selectedColor===void 0?void 0:selectedColor[1]),\", \").concat((pickedColor===null||pickedColor===void 0?void 0:pickedColor[2])||(selectedColor===null||selectedColor===void 0?void 0:selectedColor[2]),\")\")},\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"371\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_371\",\"x-dynamic\":\"false\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-left\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"377\",\"x-component\":\"div\",\"x-id\":\"ColorPicker_377\",\"x-dynamic\":\"false\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm font-mono text-gray-700\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"378\",\"x-component\":\"p\",\"x-id\":\"ColorPicker_378\",\"x-dynamic\":\"true\",children:[\"R: \",(pickedColor===null||pickedColor===void 0?void 0:pickedColor[0])||(selectedColor===null||selectedColor===void 0?void 0:selectedColor[0])]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm font-mono text-gray-700\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"381\",\"x-component\":\"p\",\"x-id\":\"ColorPicker_381\",\"x-dynamic\":\"true\",children:[\"G: \",(pickedColor===null||pickedColor===void 0?void 0:pickedColor[1])||(selectedColor===null||selectedColor===void 0?void 0:selectedColor[1])]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm font-mono text-gray-700\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"384\",\"x-component\":\"p\",\"x-id\":\"ColorPicker_384\",\"x-dynamic\":\"true\",children:[\"B: \",(pickedColor===null||pickedColor===void 0?void 0:pickedColor[2])||(selectedColor===null||selectedColor===void 0?void 0:selectedColor[2])]})]})]})]})}),/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,className:\"hidden\",\"x-file-name\":\"ColorPicker\",\"x-line-number\":\"394\",\"x-component\":\"canvas\",\"x-id\":\"ColorPicker_394\",\"x-dynamic\":\"false\"})]});};export default ColorPicker;","map":{"version":3,"names":["useState","useRef","useEffect","motion","Palette","MousePointer","RotateCcw","Settings","Button","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","ColorPicker","_ref","imageSrc","onColorSelect","selectedColor","onReset","isActive","setIsActive","cursorPosition","setCursorPosition","x","y","pickedColor","setPickedColor","sampleSize","setSampleSize","useMedian","setUseMedian","displaySampleSize","setDisplaySampleSize","canvasRef","imageRef","current","canvas","ctx","getContext","img","Image","onload","rect","getBoundingClientRect","width","height","drawImage","src","calculateBrightness","r","g","b","sampleRegionRGB","centerX","centerY","size","arguments","length","undefined","halfSize","Math","floor","startX","max","startY","endX","min","endY","imageData","getImageData","data","validPixels","brightnessThreshold","i","a","brightness","push","centerIdx","round","sortedR","map","p","sort","sortedG","sortedB","mid","sum","reduce","acc","pixel","handleImageClick","e","currentTarget","scaleX","scaleY","clientX","left","clientY","top","color","handleMouseMove","scaledSize","toggleColorPicker","resetColor","className","children","ref","alt","concat","onClick","onMouseMove","style","display","variant","div","initial","opacity","animate","type","step","value","onChange","Number","target","scale","backgroundColor"],"sources":["C:/Users/ADMIN/Desktop/Pharma/Frontend/src/components/ColorPicker.jsx"],"sourcesContent":["import { useState, useRef, useEffect } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport { Palette, MousePointer, RotateCcw, Settings } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\nconst ColorPicker = ({ imageSrc, onColorSelect, selectedColor, onReset }) => {\r\n  const [isActive, setIsActive] = useState(false);\r\n  const [cursorPosition, setCursorPosition] = useState({ x: 0, y: 0 });\r\n  const [pickedColor, setPickedColor] = useState(null);\r\n  const [sampleSize, setSampleSize] = useState(20); // Default 20x20 pixels\r\n  const [useMedian, setUseMedian] = useState(false); // Toggle between average and median\r\n  const [displaySampleSize, setDisplaySampleSize] = useState(20); // Scaled size for display\r\n  const canvasRef = useRef(null);\r\n  const imageRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (imageSrc && canvasRef.current) {\r\n      const canvas = canvasRef.current;\r\n      const ctx = canvas.getContext('2d');\r\n      const img = new Image();\r\n      \r\n      img.onload = () => {\r\n        // Set canvas size to match image display size\r\n        const rect = imageRef.current.getBoundingClientRect();\r\n        canvas.width = rect.width;\r\n        canvas.height = rect.height;\r\n        \r\n        // Draw image on canvas\r\n        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\r\n      };\r\n      \r\n      img.src = imageSrc;\r\n    }\r\n  }, [imageSrc]);\r\n\r\n  /**\r\n   * Calculate brightness of an RGB pixel\r\n   */\r\n  const calculateBrightness = (r, g, b) => {\r\n    // Using relative luminance formula\r\n    return (r * 0.299 + g * 0.587 + b * 0.114);\r\n  };\r\n\r\n  /**\r\n   * Sample a region around the tap point and calculate average/median RGB\r\n   */\r\n  const sampleRegionRGB = (ctx, centerX, centerY, size, useMedian = false) => {\r\n    const halfSize = Math.floor(size / 2);\r\n    \r\n    // Calculate bounds, ensuring we don't go outside canvas\r\n    const startX = Math.max(0, Math.floor(centerX - halfSize));\r\n    const startY = Math.max(0, Math.floor(centerY - halfSize));\r\n    const endX = Math.min(ctx.canvas.width, Math.floor(centerX + halfSize));\r\n    const endY = Math.min(ctx.canvas.height, Math.floor(centerY + halfSize));\r\n    \r\n    const width = endX - startX;\r\n    const height = endY - startY;\r\n    \r\n    // Get image data for the region\r\n    const imageData = ctx.getImageData(startX, startY, width, height);\r\n    const data = imageData.data;\r\n    \r\n    // Collect valid pixels (non-transparent and not too bright)\r\n    const validPixels = [];\r\n    const brightnessThreshold = 250; // Ignore extremely bright glare pixels\r\n    \r\n    for (let i = 0; i < data.length; i += 4) {\r\n      const r = data[i];\r\n      const g = data[i + 1];\r\n      const b = data[i + 2];\r\n      const a = data[i + 3]; // Alpha channel\r\n      \r\n      // Skip transparent pixels (alpha < 255)\r\n      if (a < 255) continue;\r\n      \r\n      // Skip extremely bright pixels (glare)\r\n      const brightness = calculateBrightness(r, g, b);\r\n      if (brightness > brightnessThreshold) continue;\r\n      \r\n      validPixels.push({ r, g, b });\r\n    }\r\n    \r\n    if (validPixels.length === 0) {\r\n      // Fallback: if no valid pixels, use all non-transparent pixels\r\n      for (let i = 0; i < data.length; i += 4) {\r\n        const r = data[i];\r\n        const g = data[i + 1];\r\n        const b = data[i + 2];\r\n        const a = data[i + 3];\r\n        if (a >= 255) {\r\n          validPixels.push({ r, g, b });\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (validPixels.length === 0) {\r\n      // Last resort: use center pixel\r\n      const centerIdx = Math.floor((width * height) / 2) * 4;\r\n      return [\r\n        Math.round(data[centerIdx]),\r\n        Math.round(data[centerIdx + 1]),\r\n        Math.round(data[centerIdx + 2])\r\n      ];\r\n    }\r\n    \r\n    if (useMedian) {\r\n      // Calculate median RGB\r\n      const sortedR = validPixels.map(p => p.r).sort((a, b) => a - b);\r\n      const sortedG = validPixels.map(p => p.g).sort((a, b) => a - b);\r\n      const sortedB = validPixels.map(p => p.b).sort((a, b) => a - b);\r\n      \r\n      const mid = Math.floor(sortedR.length / 2);\r\n      return [\r\n        sortedR.length % 2 === 0 \r\n          ? Math.round((sortedR[mid - 1] + sortedR[mid]) / 2)\r\n          : sortedR[mid],\r\n        sortedG.length % 2 === 0 \r\n          ? Math.round((sortedG[mid - 1] + sortedG[mid]) / 2)\r\n          : sortedG[mid],\r\n        sortedB.length % 2 === 0 \r\n          ? Math.round((sortedB[mid - 1] + sortedB[mid]) / 2)\r\n          : sortedB[mid]\r\n      ];\r\n    } else {\r\n      // Calculate average RGB\r\n      const sum = validPixels.reduce(\r\n        (acc, pixel) => ({\r\n          r: acc.r + pixel.r,\r\n          g: acc.g + pixel.g,\r\n          b: acc.b + pixel.b\r\n        }),\r\n        { r: 0, g: 0, b: 0 }\r\n      );\r\n      \r\n      return [\r\n        Math.round(sum.r / validPixels.length),\r\n        Math.round(sum.g / validPixels.length),\r\n        Math.round(sum.b / validPixels.length)\r\n      ];\r\n    }\r\n  };\r\n\r\n  const handleImageClick = (e) => {\r\n    if (!isActive) return;\r\n\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n\r\n    const rect = e.currentTarget.getBoundingClientRect();\r\n    const scaleX = canvas.width / rect.width;\r\n    const scaleY = canvas.height / rect.height;\r\n\r\n    const x = (e.clientX - rect.left) * scaleX;\r\n    const y = (e.clientY - rect.top) * scaleY;\r\n\r\n    const ctx = canvas.getContext('2d');\r\n    \r\n    // Sample region around tap point\r\n    const color = sampleRegionRGB(ctx, x, y, sampleSize, useMedian);\r\n    \r\n    setPickedColor(color);\r\n    onColorSelect(color);\r\n    setIsActive(false);\r\n  };\r\n\r\n  const handleMouseMove = (e) => {\r\n    if (!isActive) return;\r\n    \r\n    const rect = imageRef.current.getBoundingClientRect();\r\n    const x = e.clientX - rect.left;\r\n    const y = e.clientY - rect.top;\r\n    \r\n    setCursorPosition({ x, y });\r\n    \r\n    // Calculate display size for the sampling region indicator\r\n    if (canvasRef.current && imageRef.current) {\r\n      const scaleX = rect.width / canvasRef.current.width;\r\n      const scaleY = rect.height / canvasRef.current.height;\r\n      const scaledSize = sampleSize * Math.min(scaleX, scaleY);\r\n      setDisplaySampleSize(scaledSize);\r\n    }\r\n  };\r\n\r\n  const toggleColorPicker = () => {\r\n    setIsActive(!isActive);\r\n  };\r\n\r\n  const resetColor = () => {\r\n    setPickedColor(null);\r\n    onReset();\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Image Display */}\r\n      <div className=\"relative\">\r\n        <img\r\n          ref={imageRef}\r\n          data-testid=\"image-preview\"\r\n          src={imageSrc}\r\n          alt=\"Preview\"\r\n          className={`w-full max-h-96 object-contain rounded-2xl ${\r\n            isActive ? 'cursor-crosshair' : 'cursor-default'\r\n          }`}\r\n          onClick={handleImageClick}\r\n          onMouseMove={handleMouseMove}\r\n        />\r\n        \r\n        {/* Click indicator when active - show sampling region */}\r\n        {isActive && (\r\n          <>\r\n            {/* Center point */}\r\n            <div\r\n              className=\"absolute w-2 h-2 bg-white rounded-full shadow-lg pointer-events-none z-10\"\r\n              style={{\r\n                left: cursorPosition.x - 4,\r\n                top: cursorPosition.y - 4,\r\n              }}\r\n            />\r\n            {/* Sampling region outline - scale to displayed image size */}\r\n            <div\r\n              className=\"absolute border-2 border-blue-500 border-dashed pointer-events-none z-10\"\r\n              style={{\r\n                left: cursorPosition.x - (displaySampleSize / 2),\r\n                top: cursorPosition.y - (displaySampleSize / 2),\r\n                width: displaySampleSize,\r\n                height: displaySampleSize,\r\n              }}\r\n            />\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      {/* Color Picker Controls */}\r\n      <div className=\"space-y-3\">\r\n        <div className=\"flex items-center justify-center gap-4 flex-wrap\">\r\n          <Button\r\n            onClick={toggleColorPicker}\r\n            variant={isActive ? \"default\" : \"outline\"}\r\n            className={`${\r\n              isActive \r\n                ? \"bg-blue-600 text-white hover:bg-blue-700\" \r\n                : \"border-blue-600 text-blue-600 hover:bg-blue-50\"\r\n            }`}\r\n          >\r\n            <Palette className=\"mr-2 h-4 w-4\" />\r\n            {isActive ? \"Click on Image to Pick Color\" : \"Pick Color Manually\"}\r\n          </Button>\r\n          \r\n          {(pickedColor || selectedColor) && (\r\n            <Button\r\n              onClick={resetColor}\r\n              variant=\"outline\"\r\n              className=\"border-gray-300 text-gray-600 hover:bg-gray-50\"\r\n            >\r\n              <RotateCcw className=\"mr-2 h-4 w-4\" />\r\n              Reset to Auto\r\n            </Button>\r\n          )}\r\n        </div>\r\n\r\n        {/* Sampling Settings */}\r\n        {isActive && (\r\n          <motion.div\r\n            initial={{ opacity: 0, height: 0 }}\r\n            animate={{ opacity: 1, height: \"auto\" }}\r\n            className=\"bg-gray-50 rounded-lg p-4 space-y-3\"\r\n          >\r\n            <div className=\"flex items-center gap-2 text-sm font-medium text-gray-700\">\r\n              <Settings className=\"h-4 w-4\" />\r\n              Sampling Settings\r\n            </div>\r\n            \r\n            {/* Sample Size Control */}\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-xs text-gray-600\">\r\n                Sample Size: {sampleSize}×{sampleSize} pixels\r\n              </label>\r\n              <div className=\"flex items-center gap-2\">\r\n                <input\r\n                  type=\"range\"\r\n                  min=\"10\"\r\n                  max=\"50\"\r\n                  step=\"5\"\r\n                  value={sampleSize}\r\n                  onChange={(e) => setSampleSize(Number(e.target.value))}\r\n                  className=\"flex-1\"\r\n                />\r\n                <span className=\"text-xs text-gray-500 w-12 text-right\">\r\n                  {sampleSize}px\r\n                </span>\r\n              </div>\r\n              <div className=\"flex gap-2 text-xs text-gray-500\">\r\n                <button\r\n                  onClick={() => setSampleSize(10)}\r\n                  className={`px-2 py-1 rounded ${sampleSize === 10 ? 'bg-blue-100 text-blue-700' : ''}`}\r\n                >\r\n                  10×10\r\n                </button>\r\n                <button\r\n                  onClick={() => setSampleSize(20)}\r\n                  className={`px-2 py-1 rounded ${sampleSize === 20 ? 'bg-blue-100 text-blue-700' : ''}`}\r\n                >\r\n                  20×20\r\n                </button>\r\n                <button\r\n                  onClick={() => setSampleSize(30)}\r\n                  className={`px-2 py-1 rounded ${sampleSize === 30 ? 'bg-blue-100 text-blue-700' : ''}`}\r\n                >\r\n                  30×30\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Average vs Median Toggle */}\r\n            <div className=\"flex items-center justify-between\">\r\n              <label className=\"text-xs text-gray-600\">Calculation Method:</label>\r\n              <div className=\"flex gap-2\">\r\n                <button\r\n                  onClick={() => setUseMedian(false)}\r\n                  className={`px-3 py-1 rounded text-xs ${\r\n                    !useMedian \r\n                      ? 'bg-blue-600 text-white' \r\n                      : 'bg-gray-200 text-gray-600 hover:bg-gray-300'\r\n                  }`}\r\n                >\r\n                  Average\r\n                </button>\r\n                <button\r\n                  onClick={() => setUseMedian(true)}\r\n                  className={`px-3 py-1 rounded text-xs ${\r\n                    useMedian \r\n                      ? 'bg-blue-600 text-white' \r\n                      : 'bg-gray-200 text-gray-600 hover:bg-gray-300'\r\n                  }`}\r\n                >\r\n                  Median\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Instructions */}\r\n      {isActive && (\r\n        <motion.div\r\n          initial={{ opacity: 0, y: -10 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center\"\r\n        >\r\n            <div className=\"flex items-center justify-center gap-2 text-blue-700\">\r\n            <MousePointer className=\"h-4 w-4\" />\r\n            <span className=\"text-sm font-medium\">\r\n              Click on the test tube to sample a {sampleSize}×{sampleSize} region ({useMedian ? 'median' : 'average'} RGB)\r\n            </span>\r\n          </div>\r\n        </motion.div>\r\n      )}\r\n\r\n      {/* Selected Color Display */}\r\n      {(pickedColor || selectedColor) && (\r\n        <motion.div\r\n          initial={{ opacity: 0, scale: 0.95 }}\r\n          animate={{ opacity: 1, scale: 1 }}\r\n          className=\"bg-gray-50 rounded-lg p-4\"\r\n        >\r\n          <div className=\"text-center\">\r\n            <p className=\"text-sm font-medium text-gray-600 mb-2\">Selected Color</p>\r\n            <div className=\"flex items-center justify-center gap-4\">\r\n              <div\r\n                className=\"w-12 h-12 rounded-lg shadow-md border-2 border-white\"\r\n                style={{\r\n                  backgroundColor: `rgb(${pickedColor?.[0] || selectedColor?.[0]}, ${pickedColor?.[1] || selectedColor?.[1]}, ${pickedColor?.[2] || selectedColor?.[2]})`\r\n                }}\r\n              />\r\n              <div className=\"text-left\">\r\n                <p className=\"text-sm font-mono text-gray-700\">\r\n                  R: {pickedColor?.[0] || selectedColor?.[0]}\r\n                </p>\r\n                <p className=\"text-sm font-mono text-gray-700\">\r\n                  G: {pickedColor?.[1] || selectedColor?.[1]}\r\n                </p>\r\n                <p className=\"text-sm font-mono text-gray-700\">\r\n                  B: {pickedColor?.[2] || selectedColor?.[2]}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </motion.div>\r\n      )}\r\n\r\n      {/* Hidden Canvas for Color Detection */}\r\n      <canvas\r\n        ref={canvasRef}\r\n        className=\"hidden\"\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ColorPicker;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}